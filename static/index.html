<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI–¢–æ–≤–∞—Ä.tj - –ò–ò –∞–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel –¥–ª—è JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e5e7eb;
            border-top: 2px solid #f97316;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .drag-active {
            border-color: #f97316 !important;
            background-color: #fed7aa !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const PhotoListingApp = () => {
          const [currentStep, setCurrentStep] = useState('upload');
          const [uploadedImages, setUploadedImages] = useState([]);
          const [processing, setProcessing] = useState(false);
          const [dragActive, setDragActive] = useState(false);
          const [results, setResults] = useState([]);
          const [userDescription, setUserDescription] = useState('');
          const [apiCosts, setApiCosts] = useState([]);
          const [totalSpent, setTotalSpent] = useState(0);
          const [sessionCosts, setSessionCosts] = useState([]);
          const fileInputRef = useRef(null);

          const categories = {
            '–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å': ['–ö–≤–∞—Ä—Ç–∏—Ä—ã', '–î–æ–º–∞', '–î–∞—á–∏', '–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å', '–ó–µ–º–µ–ª—å–Ω—ã–µ —É—á–∞—Å—Ç–∫–∏', '–ì–∞—Ä–∞–∂–∏'],
            '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': ['–õ–µ–≥–∫–æ–≤—ã–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏', '–ì—Ä—É–∑–æ–≤–∏–∫–∏', '–ú–æ—Ç–æ—Ü–∏–∫–ª—ã', '–ê–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏', '–®–∏–Ω—ã –∏ –¥–∏—Å–∫–∏'],
            '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ –±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞': ['–¢–µ–ª–µ—Ñ–æ–Ω—ã –∏ —Å–≤—è–∑—å', '–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞', '–¢–µ–ª–µ–≤–∏–∑–æ—Ä—ã', '–ê—É–¥–∏–æ—Ç–µ—Ö–Ω–∏–∫–∞', '–§–æ—Ç–æ –∏ –≤–∏–¥–µ–æ'],
            '–û–¥–µ–∂–¥–∞ –∏ –ª–∏—á–Ω—ã–µ –≤–µ—â–∏': ['–ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞', '–ñ–µ–Ω—Å–∫–∞—è –æ–¥–µ–∂–¥–∞', '–î–µ—Ç—Å–∫–∞—è –æ–¥–µ–∂–¥–∞', '–û–±—É–≤—å', '–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã'],
            '–í—Å–µ –¥–ª—è –¥–æ–º–∞': ['–ú–µ–±–µ–ª—å', '–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞', '–ü–æ—Å—É–¥–∞', '–¢–µ–∫—Å—Ç–∏–ª—å', '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã'],
            '–î–µ—Ç—Å–∫–∏–π –º–∏—Ä': ['–î–µ—Ç—Å–∫–∞—è –æ–¥–µ–∂–¥–∞', '–î–µ—Ç—Å–∫–∞—è –æ–±—É–≤—å', '–î–µ—Ç—Å–∫–∞—è –º–µ–±–µ–ª—å', '–î–µ—Ç—Å–∫–∏–µ –∞–≤—Ç–æ–∫—Ä–µ—Å–ª–∞', '–î–µ—Ç—Å–∫–∏–µ –∫–æ–ª—è—Å–∫–∏', '–ò–≥—Ä—É—à–∫–∏'],
            '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ, —Å—ã—Ä—å–µ –∏ —Ä–µ–º–æ–Ω—Ç': ['–°—Ç—Ä–æ–π–º–∞—Ç–µ—Ä–∏–∞–ª—ã', '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã', '–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞', '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞'],
            '–†–∞–±–æ—Ç–∞': ['–í–∞–∫–∞–Ω—Å–∏–∏', '–†–µ–∑—é–º–µ', '–£—Å–ª—É–≥–∏']
          };

          const conditions = ['–ù–æ–≤–æ–µ', '–û—Ç–ª–∏—á–Ω–æ–µ', '–•–æ—Ä–æ—à–µ–µ', '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ', '–ù–∞ –∑–∞–ø—á–∞—Å—Ç–∏'];
          const currencies = ['—Å–æ–º–æ–Ω–∏', '–¥–æ–ª–ª–∞—Ä', '–µ–≤—Ä–æ'];

          // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
          useEffect(() => {
            try {
              const savedCosts = localStorage.getItem('ai_tovar_costs');
              if (savedCosts) {
                const costs = JSON.parse(savedCosts);
                setApiCosts(costs);
                setTotalSpent(costs.reduce((sum, cost) => sum + (cost.total_cost_rub || 0), 0));
              }
            } catch (error) {
              console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', error);
            }
          }, []);

          // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤
          const saveCosts = (newCosts) => {
            try {
              const allCosts = [...apiCosts, ...newCosts];
              setApiCosts(allCosts);
              localStorage.setItem('ai_tovar_costs', JSON.stringify(allCosts));
              
              const newTotal = allCosts.reduce((sum, cost) => sum + (cost.total_cost_rub || 0), 0);
              setTotalSpent(newTotal);
            } catch (error) {
              console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–æ–≤:', error);
            }
          };

          const handleDrag = (e) => {
            e.preventDefault();
            e.stopPropagation();
            if (e.type === "dragenter" || e.type === "dragover") {
              setDragActive(true);
            } else if (e.type === "dragleave") {
              setDragActive(false);
            }
          };

          const handleDrop = (e) => {
            e.preventDefault();
            e.stopPropagation();
            setDragActive(false);
            
            const files = Array.from(e.dataTransfer.files);
            handleFiles(files);
          };

          const handleFileSelect = (e) => {
            const files = Array.from(e.target.files);
            handleFiles(files);
          };

          const handleFiles = (files) => {
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
              alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π');
              return;
            }

            imageFiles.forEach(file => {
              const reader = new FileReader();
              reader.onload = (e) => {
                setUploadedImages(prev => [...prev, {
                  id: Date.now() + Math.random(),
                  file,
                  preview: e.target.result,
                  name: file.name,
                  size: file.size
                }]);
              };
              reader.readAsDataURL(file);
            });
          };

          const removeImage = (id) => {
            setUploadedImages(prev => prev.filter(img => img.id !== id));
          };

          const processImages = async () => {
            if (uploadedImages.length === 0) {
              alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞');
              return;
            }

            setProcessing(true);
            setSessionCosts([]);
            
            try {
              const formData = new FormData();
              uploadedImages.forEach(img => {
                formData.append('files', img.file);
              });
              
              const response = await fetch('/api/analyze-multiple', {
                method: 'POST',
                body: formData
              });
              
              if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
              }
              
              const data = await response.json();
              
              if (data.success) {
                const processedResults = data.results.map(result => ({
                  id: result.id,
                  images: [result.image_preview],
                  title: extractTitle(result.description),
                  description: result.description,
                  mainCategory: detectCategory(result.description),
                  subCategory: detectSubCategory(result.description),
                  price: extractPrice(result.description),
                  currency: '—Å–æ–º–æ–Ω–∏',
                  brand: extractBrand(result.description),
                  condition: extractCondition(result.description),
                  location: '–î—É—à–∞–Ω–±–µ',
                  userInput: userDescription,
                  apiCost: result.api_cost,
                  filename: result.filename,
                  width: result.width,
                  height: result.height,
                  size_bytes: result.size_bytes
                }));
                
                setResults(processedResults);
                
                const newCosts = data.results.map(result => ({
                  ...result.api_cost,
                  timestamp: new Date().toISOString(),
                  filename: result.filename
                }));
                
                setSessionCosts(newCosts);
                saveCosts(newCosts);
                
                setCurrentStep('results');
              } else {
                throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
              }
              
            } catch (error) {
              console.error('–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:', error);
              alert(`–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: ${error.message}`);
            } finally {
              setProcessing(false);
            }
          };

          // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –æ–ø–∏—Å–∞–Ω–∏—è
          const extractTitle = (description) => {
            const lines = description.split('\n').filter(line => line.trim());
            for (let line of lines) {
              if (line.includes('–¢–û–í–ê–† –ò –ö–ê–¢–ï–ì–û–†–ò–Ø:')) {
                const nextLineIndex = lines.indexOf(line) + 1;
                if (nextLineIndex < lines.length) {
                  const nextLine = lines[nextLineIndex];
                  if (nextLine && nextLine.startsWith('- ')) {
                    return nextLine.substring(2).trim();
                  }
                }
              }
            }
            for (let line of lines) {
              if (line.length > 10 && line.length < 100 && !line.includes(':')) {
                return line.trim();
              }
            }
            return '–¢–æ–≤–∞—Ä –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏';
          };

          const detectCategory = (description) => {
            const categoryKeywords = {
              '–û–¥–µ–∂–¥–∞ –∏ –ª–∏—á–Ω—ã–µ –≤–µ—â–∏': ['–∫—Ä–æ—Å—Å–æ–≤–∫–∏', '–æ–±—É–≤—å', '–æ–¥–µ–∂–¥–∞', '—Ñ—É—Ç–±–æ–ª–∫–∞', '–¥–∂–∏–Ω—Å—ã', '–ø–ª–∞—Ç—å–µ', '—Ä—É–±–∞—à–∫–∞', '–∫—É—Ä—Ç–∫–∞'],
              '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞ –∏ –±—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞': ['–Ω–æ—É—Ç–±—É–∫', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–∫–æ–º–ø—å—é—Ç–µ—Ä', '—Ç–µ–ª–µ–≤–∏–∑–æ—Ä', '—Ç–µ—Ö–Ω–∏–∫–∞', '–ø–ª–∞–Ω—à–µ—Ç', '—Å–º–∞—Ä—Ç—Ñ–æ–Ω'],
              '–î–µ—Ç—Å–∫–∏–π –º–∏—Ä': ['–¥–µ—Ç—Å–∫', '–∞–≤—Ç–æ–∫—Ä–µ—Å–ª–æ', '–∫–æ–ª—è—Å–∫–∞', '–∏–≥—Ä—É—à–∫–∞', '—Ä–µ–±–µ–Ω–æ–∫'],
              '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç': ['–∞–≤—Ç–æ–º–æ–±–∏–ª—å', '–º–∞—à–∏–Ω–∞', '–º–æ—Ç–æ—Ü–∏–∫–ª', '–∑–∞–ø—á–∞—Å—Ç–∏', '–∫–æ–ª–µ—Å–∞', '—à–∏–Ω—ã'],
              '–í—Å–µ –¥–ª—è –¥–æ–º–∞': ['–º–µ–±–µ–ª—å', '—Å—Ç–æ–ª', '—Å—Ç—É–ª', '–¥–∏–≤–∞–Ω', '–∫—Ä–æ–≤–∞—Ç—å', '—à–∫–∞—Ñ', '–ø–æ—Å—É–¥–∞']
            };
            
            const lowerDesc = description.toLowerCase();
            for (let [category, keywords] of Object.entries(categoryKeywords)) {
              if (keywords.some(keyword => lowerDesc.includes(keyword))) {
                return category;
              }
            }
            return '–í—Å–µ –¥–ª—è –¥–æ–º–∞';
          };

          const detectSubCategory = (description) => {
            const lowerDesc = description.toLowerCase();
            if (lowerDesc.includes('–∫—Ä–æ—Å—Å–æ–≤–∫–∏') || lowerDesc.includes('–æ–±—É–≤—å')) return '–û–±—É–≤—å';
            if (lowerDesc.includes('–Ω–æ—É—Ç–±—É–∫') || lowerDesc.includes('–∫–æ–º–ø—å—é—Ç–µ—Ä')) return '–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –∏ –æ—Ä–≥—Ç–µ—Ö–Ω–∏–∫–∞';
            if (lowerDesc.includes('—Ç–µ–ª–µ—Ñ–æ–Ω') || lowerDesc.includes('—Å–º–∞—Ä—Ç—Ñ–æ–Ω')) return '–¢–µ–ª–µ—Ñ–æ–Ω—ã –∏ —Å–≤—è–∑—å';
            if (lowerDesc.includes('–¥–µ—Ç—Å–∫')) return '–î–µ—Ç—Å–∫–∏–µ —Ç–æ–≤–∞—Ä—ã';
            if (lowerDesc.includes('–∞–≤—Ç–æ–∫—Ä–µ—Å–ª–æ')) return '–î–µ—Ç—Å–∫–∏–µ –∞–≤—Ç–æ–∫—Ä–µ—Å–ª–∞';
            if (lowerDesc.includes('–æ–¥–µ–∂–¥–∞') || lowerDesc.includes('—Ñ—É—Ç–±–æ–ª–∫–∞')) return '–ú—É–∂—Å–∫–∞—è –æ–¥–µ–∂–¥–∞';
            return '–î—Ä—É–≥–æ–µ';
          };

          const extractPrice = (description) => {
            const priceMatch = description.match(/(\d+)\s*(—Å–æ–º–æ–Ω–∏|–¥–æ–ª–ª–∞—Ä|—Ä—É–±–ª)/i);
            if (priceMatch) {
              return priceMatch[1];
            }
            return '0';
          };

          const extractBrand = (description) => {
            const brands = ['Nike', 'Adidas', 'Samsung', 'Apple', 'HP', 'Dell', 'Sony', 'LG', 'MAXI-COSI', 'IKEA', 'Zara', 'H&M'];
            const lowerDesc = description.toLowerCase();
            for (let brand of brands) {
              if (lowerDesc.includes(brand.toLowerCase())) {
                return brand;
              }
            }
            return '';
          };

          const extractCondition = (description) => {
            const lowerDesc = description.toLowerCase();
            if (lowerDesc.includes('–Ω–æ–≤—ã–π') || lowerDesc.includes('–Ω–æ–≤–æ–µ')) return '–ù–æ–≤–æ–µ';
            if (lowerDesc.includes('–æ—Ç–ª–∏—á–Ω–æ–µ') || lowerDesc.includes('–æ—Ç–ª–∏—á–Ω–æ')) return '–û—Ç–ª–∏—á–Ω–æ–µ';
            if (lowerDesc.includes('—Ö–æ—Ä–æ—à–µ–µ') || lowerDesc.includes('—Ö–æ—Ä–æ—à–æ')) return '–•–æ—Ä–æ—à–µ–µ';
            if (lowerDesc.includes('—É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ')) return '–£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ–µ';
            return '–•–æ—Ä–æ—à–µ–µ';
          };

          const updateResult = (id, field, value) => {
            setResults(prev => prev.map(item => 
              item.id === id ? { ...item, [field]: value } : item
            ));
          };

          const deleteResult = (id) => {
            setResults(prev => prev.filter(item => item.id !== id));
          };

          const SomonLogo = () => (
            <div className="flex items-center">
              <span className="text-blue-600 font-bold text-xl">AI</span>
              <span className="text-orange-500 font-bold text-xl">–¢–æ–≤–∞—Ä</span>
              <span className="text-green-500 font-bold text-xl">.tj</span>
            </div>
          );

          // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤
          const ApiCostDisplay = () => {
            const todayCosts = sessionCosts;
            const todayTotal = todayCosts.reduce((sum, cost) => sum + (cost.total_cost_rub || 0), 0);

            return (
              <div className="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg border border-blue-200 p-4 mb-4">
                <div className="flex items-center mb-3">
                  <span className="text-blue-600 mr-2">üí∞</span>
                  <h3 className="font-medium text-blue-800">–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –ò–ò –∞–Ω–∞–ª–∏–∑</h3>
                </div>
                <div className="grid grid-cols-2 gap-3 text-sm">
                  <div className="bg-white rounded p-2">
                    <div className="text-blue-600 font-medium">–≠—Ç–∞ —Å–µ—Å—Å–∏—è</div>
                    <div className="text-lg font-bold text-blue-800">‚ÇΩ{todayTotal.toFixed(3)}</div>
                    {todayCosts.length > 0 && (
                      <div className="text-xs text-gray-600">{todayCosts.length} –∞–Ω–∞–ª–∏–∑–æ–≤</div>
                    )}
                  </div>
                  <div className="bg-white rounded p-2">
                    <div className="text-purple-600 font-medium">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
                    <div className="text-lg font-bold text-purple-800">‚ÇΩ{totalSpent.toFixed(2)}</div>
                    <div className="text-xs text-gray-600">{apiCosts.length} –≤—Å–µ–≥–æ</div>
                  </div>
                </div>
                {todayCosts.length > 0 && (
                  <div className="mt-3 p-2 bg-white rounded text-xs">
                    <div className="font-medium text-gray-700 mb-1">–î–µ—Ç–∞–ª–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–µ—Å—Å–∏–∏:</div>
                    <div className="text-gray-600">
                      –¢–æ–∫–µ–Ω–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {todayCosts.reduce((sum, c) => sum + (c.image_tokens || 0) + (c.output_tokens || 0), 0).toLocaleString()}
                    </div>
                    <div className="text-gray-600">
                      –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞ –∞–Ω–∞–ª–∏–∑: ‚ÇΩ{(todayTotal / todayCosts.length).toFixed(3)}
                    </div>
                  </div>
                )}
              </div>
            );
          };

          if (currentStep === 'upload') {
            return (
              <div className="min-h-screen bg-gray-50">
                <div className="max-w-2xl mx-auto p-4">
                  <div className="bg-white border-b border-gray-200 p-4 rounded-t-lg">
                    <div className="flex items-center justify-between">
                      <SomonLogo />
                      <span className="text-gray-600">‚ò∞</span>
                    </div>
                  </div>

                  <div className="bg-white p-4 rounded-b-lg shadow-lg">
                    <div className="text-center mb-6">
                      <div className="inline-flex items-center justify-center w-16 h-16 bg-orange-500 rounded-full mb-4">
                        <span className="text-white text-2xl">üì∑</span>
                      </div>
                      <h1 className="text-2xl font-bold text-gray-800 mb-2">
                        –ò–ò –ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–æ–≤
                      </h1>
                      <p className="text-gray-600 text-sm">
                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –ø–æ–º–æ—â—å—é Claude AI
                      </p>
                    </div>

                    {totalSpent > 0 && <ApiCostDisplay />}

                    <div className="border-2 border-dashed border-gray-300 rounded-lg p-6 mb-4">
                      <div
                        className={`relative transition-all ${
                          dragActive ? 'drag-active' : ''
                        }`}
                        onDragEnter={handleDrag}
                        onDragLeave={handleDrag}
                        onDragOver={handleDrag}
                        onDrop={handleDrop}
                      >
                        <input
                          ref={fileInputRef}
                          type="file"
                          multiple
                          accept="image/*"
                          onChange={handleFileSelect}
                          className="hidden"
                        />
                        
                        <div className="text-center">
                          <span className="text-4xl mb-3 block">üì§</span>
                          <h3 className="text-base font-medium text-gray-700 mb-2">
                            –î–æ–±–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤
                          </h3>
                          <p className="text-gray-500 text-sm mb-4">
                            –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞
                          </p>
                          <button
                            onClick={() => fileInputRef.current?.click()}
                            className="bg-orange-500 text-white px-6 py-2 rounded-lg text-sm font-medium hover:bg-orange-600 transition-colors"
                          >
                            –í—ã–±—Ä–∞—Ç—å —Ñ–æ—Ç–æ
                          </button>
                        </div>
                      </div>
                    </div>

                    {uploadedImages.length > 0 && (
                      <div className="mb-4">
                        <div className="flex items-center justify-between mb-3">
                          <h3 className="text-sm font-medium text-gray-700">
                            –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {uploadedImages.length} —Ñ–æ—Ç–æ
                          </h3>
                          <div className="text-xs text-blue-600">
                            ~‚ÇΩ{(uploadedImages.length * 1.5).toFixed(2)} –∑–∞ –∞–Ω–∞–ª–∏–∑
                          </div>
                        </div>
                        <div className="grid grid-cols-3 gap-2">
                          {uploadedImages.map((image) => (
                            <div key={image.id} className="relative">
                              <img
                                src={image.preview}
                                alt={image.name}
                                className="w-full h-24 object-cover rounded border"
                              />
                              <button
                                onClick={() => removeImage(image.id)}
                                className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600"
                              >
                                √ó
                              </button>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {uploadedImages.length > 0 && (
                      <div className="mb-4">
                        <h3 className="text-sm font-medium text-gray-700 mb-2">
                          –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–≤–∞—Ä–∞—Ö (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                        </h3>
                        <textarea
                          value={userDescription}
                          onChange={(e) => setUserDescription(e.target.value)}
                          placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
1. –ö—Ä–æ—Å—Å–æ–≤–∫–∏ Nike, —Ä–∞–∑–º–µ—Ä 42, –Ω–æ–≤—ã–µ, —Ü–µ–Ω–∞ 500 —Å–æ–º–æ–Ω–∏
2. –°—Ç–∏—Ä–∞–ª—å–Ω–∞—è –º–∞—à–∏–Ω–∞ LG, 5–∫–≥, –æ—Ç–ª–∏—á–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, 800 —Å–æ–º–æ–Ω–∏  
3. –î–µ—Ç—Å–∫–æ–µ –∞–≤—Ç–æ–∫—Ä–µ—Å–ª–æ, –∫—Ä–∞—Å–Ω–æ–µ, —Ö–æ—Ä–æ—à–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, 300 —Å–æ–º–æ–Ω–∏

–£–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è, —Ä–∞–∑–º–µ—Ä—ã, —Ü–µ–Ω—ã, —Å–æ—Å—Ç–æ—è–Ω–∏–µ - —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ò–ò —Å–æ–∑–¥–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è."
                          rows={6}
                          className="w-full p-3 border border-gray-300 rounded-lg text-sm placeholder-gray-400 focus:ring-1 focus:ring-orange-500 focus:border-orange-500"
                        />
                        <p className="text-xs text-gray-500 mt-1">
                          –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ ‚Ä¢ –ü–æ–º–æ–∂–µ—Ç –ò–ò —Å–æ–∑–¥–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è
                        </p>
                      </div>
                    )}

                    {uploadedImages.length > 0 && (
                      <div className="mb-4">
                        <button
                          onClick={processImages}
                          disabled={processing}
                          className="w-full bg-orange-500 text-white py-3 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors"
                        >
                          {processing ? (
                            <div className="flex items-center justify-center">
                              <div className="spinner mr-2"></div>
                              Claude AI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã...
                            </div>
                          ) : (
                            `–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å ${uploadedImages.length} —Ç–æ–≤–∞—Ä–æ–≤ —Å –ò–ò`
                          )}
                        </button>
                      </div>
                    )}

                    <div className="space-y-3">
                      <div className="bg-white rounded-lg border p-4 flex items-center">
                        <span className="text-2xl mr-3">‚ö°</span>
                        <div>
                          <h3 className="font-medium text-gray-800 text-sm">Claude AI —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ</h3>
                          <p className="text-gray-600 text-xs">–ú–æ—â–Ω—ã–π –ò–ò –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–æ–≤–∞—Ä—ã</p>
                        </div>
                      </div>
                      
                      <div className="bg-white rounded-lg border p-4 flex items-center">
                        <span className="text-2xl mr-3">üíæ</span>
                        <div>
                          <h3 className="font-medium text-gray-800 text-sm">–£–º–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è</h3>
                          <p className="text-gray-600 text-xs">–ò–ò —Å–æ–∑–¥–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏</p>
                        </div>
                      </div>
                      
                      <div className="bg-white rounded-lg border p-4 flex items-center">
                        <span className="text-2xl mr-3">üìä</span>
                        <div>
                          <h3 className="font-medium text-gray-800 text-sm">–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
                          <p className="text-gray-600 text-xs">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞</p>
                        </div>
                      </div>

                      {userDescription && (
                        <div className="bg-orange-50 border border-orange-200 rounded-lg p-4 flex items-center">
                          <span className="text-orange-500 mr-3">üî∏</span>
                          <div>
                            <h3 className="font-medium text-orange-800 text-sm">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞</h3>
                            <p className="text-orange-600 text-xs">–ò–ò —É—á—Ç–µ—Ç –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</p>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              </div>
            );
          }

          return (
            <div className="min-h-screen bg-gray-50">
              <div className="max-w-2xl mx-auto p-4">
                <div className="bg-white border-b border-gray-200 p-4 rounded-t-lg">
                  <div className="flex items-center">
                    <button onClick={() => setCurrentStep('upload')} className="mr-3">
                      <span className="text-gray-600">‚Üê</span>
                    </button>
                    <div className="flex-1">
                      <h1 className="text-lg font-bold text-gray-800">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</h1>
                      <p className="text-xs text-gray-600">Claude AI –Ω–∞—à–µ–ª {results.length} —Ç–æ–≤–∞—Ä–æ–≤</p>
                    </div>
                  </div>
                </div>

                <div className="bg-white p-4 rounded-b-lg shadow-lg">
                  <ApiCostDisplay />
                  
                  <div className="space-y-4 mb-6">
                    {results.map((item) => (
                      <ResultCard 
                        key={item.id} 
                        item={item} 
                        categories={categories}
                        conditions={conditions}
                        currencies={currencies}
                        onUpdate={updateResult} 
                        onDelete={deleteResult}
                      />
                    ))}
                  </div>

                  {results.length === 0 && (
                    <div className="text-center py-8">
                      <span className="text-4xl mb-3 block">‚ö†Ô∏è</span>
                      <h3 className="text-lg font-medium text-gray-700 mb-2">–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</h3>
                      <p className="text-gray-500 text-sm mb-4">–î–æ–±–∞–≤—å—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</p>
                      <button 
                        onClick={() => setCurrentStep('upload')}
                        className="bg-orange-500 text-white px-6 py-2 rounded-lg font-medium hover:bg-orange-600 transition-colors"
                      >
                        –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        const ResultCard = ({ item, categories, conditions, currencies, onUpdate, onDelete }) => {
          const [formData, setFormData] = useState(item);
          const [isExpanded, setIsExpanded] = useState(false);

          const handleChange = (field, value) => {
            const newData = { ...formData, [field]: value };
            setFormData(newData);
            onUpdate(item.id, field, value);
          };

          const handleMainCategoryChange = (mainCategory) => {
            handleChange('mainCategory', mainCategory);
            if (categories[mainCategory] && categories[mainCategory].length > 0) {
              handleChange('subCategory', categories[mainCategory][0]);
            }
          };

          return (
            <div className="bg-white rounded-lg border">
              <div className="p-4">
                <div className="flex">
                  <img 
                    src={item.images[0]} 
                    alt={formData.title} 
                    className="w-16 h-16 object-cover rounded mr-3 flex-shrink-0" 
                  />
                  <div className="flex-1 min-w-0">
                    <input
                      type="text"
                      value={formData.title}
                      onChange={(e) => handleChange('title', e.target.value)}
                      className="w-full font-medium text-gray-800 border-none p-0 text-sm bg-transparent focus:outline-none"
                      placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                    />
                    <div className="flex items-center mt-1">
                      <input
                        type="number"
                        value={formData.price}
                        onChange={(e) => handleChange('price', e.target.value)}
                        className="w-16 text-orange-500 font-bold text-sm border-none p-0 bg-transparent focus:outline-none"
                        placeholder="0"
                      />
                      <span className="text-orange-500 font-bold text-sm ml-1">{formData.currency}</span>
                    </div>
                    <div className="flex items-center justify-between mt-1">
                      <span className="bg-orange-100 text-orange-800 px-2 py-0.5 rounded text-xs">
                        {formData.mainCategory}
                      </span>
                      {item.apiCost && (
                        <span className="bg-blue-50 text-blue-600 px-2 py-0.5 rounded text-xs">
                          ‚ÇΩ{item.apiCost.total_cost_rub?.toFixed(3) || '0.000'}
                        </span>
                      )}
                    </div>
                  </div>
                  <button
                    onClick={() => setIsExpanded(!isExpanded)}
                    className="text-gray-400 p-1 hover:text-gray-600"
                  >
                    {isExpanded ? '‚àí' : '+'}
                  </button>
                </div>
              </div>

              {isExpanded && (
                <div className="px-4 pb-4 border-t border-gray-100 pt-4 space-y-3">
                  {/* –ü–æ–∫–∞–∑ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏–∑–∞ */}
                  {item.apiCost && (
                    <div className="bg-blue-50 rounded p-3 text-xs">
                      <div className="font-medium text-blue-800 mb-2">–°—Ç–æ–∏–º–æ—Å—Ç—å Claude AI –∞–Ω–∞–ª–∏–∑–∞:</div>
                      <div className="grid grid-cols-2 gap-2 text-blue-700">
                        <div>–í—Ö–æ–¥—è—â–∏–µ —Ç–æ–∫–µ–Ω—ã: {item.apiCost.image_tokens?.toLocaleString() || '0'}</div>
                        <div>–ò—Å—Ö–æ–¥—è—â–∏–µ —Ç–æ–∫–µ–Ω—ã: {item.apiCost.output_tokens?.toLocaleString() || '0'}</div>
                        <div>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤—Ö–æ–¥–∞: ${item.apiCost.input_cost_usd?.toFixed(4) || '0.0000'}</div>
                        <div>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã—Ö–æ–¥–∞: ${item.apiCost.output_cost_usd?.toFixed(4) || '0.0000'}</div>
                      </div>
                      <div className="font-bold text-blue-800 mt-2 text-center">
                        –ò—Ç–æ–≥–æ: ‚ÇΩ{item.apiCost.total_cost_rub?.toFixed(4) || '0.0000'} (${item.apiCost.total_cost_usd?.toFixed(4) || '0.0000'})
                      </div>
                    </div>
                  )}

                  <div>
                    <label className="block text-xs text-gray-600 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select
                      value={formData.mainCategory}
                      onChange={(e) => handleMainCategoryChange(e.target.value)}
                      className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-orange-500"
                    >
                      {Object.keys(categories).map(cat => (
                        <option key={cat} value={cat}>{cat}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-xs text-gray-600 mb-1">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select
                      value={formData.subCategory}
                      onChange={(e) => handleChange('subCategory', e.target.value)}
                      className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-orange-500"
                    >
                      {categories[formData.mainCategory]?.map(subcat => (
                        <option key={subcat} value={subcat}>{subcat}</option>
                      ))}
                    </select>
                  </div>

                  <div>
                    <label className="block text-xs text-gray-600 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç Claude AI</label>
                    <textarea
                      value={formData.description}
                      onChange={(e) => handleChange('description', e.target.value)}
                      rows={8}
                      className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-orange-500"
                      placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
                    />
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                    <div>
                      <label className="block text-xs text-gray-600 mb-1">–ë—Ä–µ–Ω–¥</label>
                      <input
                        type="text"
                        value={formData.brand}
                        onChange={(e) => handleChange('brand', e.target.value)}
                        className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-orange-500"
                        placeholder="–ë—Ä–µ–Ω–¥"
                      />
                    </div>

                    <div>
                      <label className="block text-xs text-gray-600 mb-1">–°–æ—Å—Ç–æ—è–Ω–∏–µ</label>
                      <select
                        value={formData.condition}
                        onChange={(e) => handleChange('condition', e.target.value)}
                        className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-orange-500"
                      >
                        {conditions.map(cond => (
                          <option key={cond} value={cond}>{cond}</option>
                        ))}
                      </select>
                    </div>
                  </div>

                  <div>
                    <label className="block text-xs text-gray-600 mb-1">–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</label>
                    <input
                      type="text"
                      value={formData.location}
                      onChange={(e) => handleChange('location', e.target.value)}
                      className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-orange-500"
                      placeholder="–ì–æ—Ä–æ–¥"
                    />
                  </div>

                  <div className="flex space-x-2 pt-2">
                    <button 
                      onClick={() => onDelete(item.id)}
                      className="flex-1 bg-red-50 text-red-600 py-2 rounded text-sm font-medium hover:bg-red-100 transition-colors"
                    >
                      –£–¥–∞–ª–∏—Ç—å
                    </button>
                    <button 
                      onClick={() => alert('–û–±—ä—è–≤–ª–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏!')}
                      className="flex-1 bg-orange-500 text-white py-2 rounded text-sm font-medium hover:bg-orange-600 transition-colors"
                    >
                      –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                    </button>
                  </div>
                </div>
              )}
            </div>
          );
        };

        // –†–µ–Ω–¥–µ—Ä–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<PhotoListingApp />);
    </script>
</body>
</html>
