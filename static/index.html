<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Somon.tj - Подать объявление</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel для JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'somon-blue': '#2563eb',
            'somon-orange': '#ea580c',
            'somon-green': '#16a34a'
          }
        }
      }
    }
  </script>

  <style>
    .mobile-container {
      max-width: 480px;
      margin: 0 auto;
    }

    @media (min-width: 768px) {
      .mobile-container {
        max-width: 768px;
      }
    }

    @media (min-width: 1024px) {
      .mobile-container {
        max-width: 1024px;
      }
    }

    .drag-active {
      border-color: #ea580c !important;
      background-color: #fed7aa !important;
    }

    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid #ea580c;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .product-card {
      transition: all 0.2s ease;
    }

    .product-card:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;

    const PhotoListingApp = () => {
      const [currentStep, setCurrentStep] = useState('upload'); // 'upload', 'results', 'promotion'
      const [uploadedImages, setUploadedImages] = useState([]);
      const [processing, setProcessing] = useState(false);
      const [dragActive, setDragActive] = useState(false);
      const [results, setResults] = useState([]);
      const [publishedItems, setPublishedItems] = useState([]);
      const [userDescription, setUserDescription] = useState('');
      const fileInputRef = useRef(null);

      // Категории будут загружены с сервера
      const [categories, setCategories] = useState({});
      const [categoriesLoaded, setCategoriesLoaded] = useState(false);

      const conditions = ['Новое', 'Отличное', 'Хорошее', 'Удовлетворительное', 'На запчасти'];
      const currencies = ['сомони', 'доллар', 'евро'];

      // Функция для загрузки категорий с сервера
      const loadCategories = async () => {
        try {
          const response = await fetch('/api/categories');
          const data = await response.json();

          if (data.success) {
            setCategories(data.categories);
            setCategoriesLoaded(true);
            console.log('Категории загружены:', data.categories);
          } else {
            console.error('Ошибка загрузки категорий:', data.error);
            // Fallback к базовым категориям
            setCategories({
              'Одежда и личные вещи': ['Мужская одежда', 'Женская одежда', 'Обувь'],
              'Электроника и бытовая техника': ['Телефоны и связь', 'Компьютеры и оргтехника'],
              'Детский мир': ['Детская одежда', 'Игрушки'],
              'Все для дома': ['Мебель', 'Бытовая техника']
            });
            setCategoriesLoaded(true);
          }
        } catch (error) {
          console.error('Ошибка при загрузке категорий:', error);
          // Fallback к базовым категориям
          setCategories({
            'Одежда и личные вещи': ['Мужская одежда', 'Женская одежда', 'Обувь'],
            'Электроника и бытовая техника': ['Телефоны и связь', 'Компьютеры и оргтехника'],
            'Детский мир': ['Детская одежда', 'Игрушки'],
            'Все для дома': ['Мебель', 'Бытовая техника']
          });
          setCategoriesLoaded(true);
        }
      };

      // Загружаем категории при старте
      useEffect(() => {
        loadCategories();
      }, []);

      const handleDrag = (e) => {
        e.preventDefault();
        e.stopPropagation();
        if (e.type === "dragenter" || e.type === "dragover") {
          setDragActive(true);
        } else if (e.type === "dragleave") {
          setDragActive(false);
        }
      };

      const handleDrop = (e) => {
        e.preventDefault();
        e.stopPropagation();
        setDragActive(false);

        const files = Array.from(e.dataTransfer.files);
        handleFiles(files);
      };

      const handleFileSelect = (e) => {
        const files = Array.from(e.target.files);
        handleFiles(files);
      };

      const handleFiles = (files) => {
        const imageFiles = files.filter(file => file.type.startsWith('image/'));

        imageFiles.forEach(file => {
          const reader = new FileReader();
          reader.onload = (e) => {
            setUploadedImages(prev => [...prev, {
              id: Date.now() + Math.random(),
              file,
              preview: e.target.result,
              name: file.name,
              size: file.size
            }]);
          };
          reader.readAsDataURL(file);
        });
      };

      const removeImage = (id) => {
        setUploadedImages(prev => prev.filter(img => img.id !== id));
      };

      const processImages = async () => {
        if (uploadedImages.length === 0) {
          alert('Пожалуйста, добавьте изображения для анализа');
          return;
        }

        setProcessing(true);

        try {
          const formData = new FormData();
          uploadedImages.forEach(img => {
            formData.append('files', img.file);
          });

          const response = await fetch('/api/analyze-multiple', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
          }

          const data = await response.json();

          if (data.success) {
            const processedResults = data.results.map(result => {
              const mainCategory = detectCategory(result.description);
              return {
                id: result.id,
                images: [result.image_preview],
                title: extractTitle(result.description),
                description: result.description,
                mainCategory: mainCategory,
                subCategory: detectSubCategory(result.description, mainCategory),
                price: extractPrice(result.description),
                currency: 'сомони',
                brand: extractBrand(result.description),
                condition: extractCondition(result.description),
                location: 'Душанбе',
                userInput: userDescription,
                filename: result.filename,
                width: result.width,
                height: result.height,
                size_bytes: result.size_bytes
              };
            });

            setResults(processedResults);
            setCurrentStep('results');
          } else {
            throw new Error(data.error || 'Неизвестная ошибка');
          }

        } catch (error) {
          console.error('Ошибка обработки:', error);
          alert(`Ошибка обработки изображений: ${error.message}`);
        } finally {
          setProcessing(false);
        }
      };

      // Функции для извлечения данных из описания
      const extractTitle = (description) => {
        const lines = description.split('\n').filter(line => line.trim());
        for (let line of lines) {
          if (line.includes('ТОВАР И КАТЕГОРИЯ:')) {
            const nextLineIndex = lines.indexOf(line) + 1;
            if (nextLineIndex < lines.length) {
              const nextLine = lines[nextLineIndex];
              if (nextLine && nextLine.startsWith('- ')) {
                return nextLine.substring(2).trim();
              }
            }
          }
        }
        for (let line of lines) {
          if (line.length > 10 && line.length < 100 && !line.includes(':')) {
            return line.trim();
          }
        }
        return 'Товар для продажи';
      };

      const detectCategory = (description) => {
        const categoryKeywords = {
          'Одежда и личные вещи': ['кроссовки', 'обувь', 'одежда', 'футболка', 'джинсы', 'платье', 'рубашка', 'брюки', 'юбка', 'куртка'],
          'Электроника и бытовая техника': ['ноутбук', 'телефон', 'компьютер', 'телевизор', 'техника', 'планшет', 'наушники'],
          'Телефоны и связь': ['телефон', 'смартфон', 'айфон', 'samsung', 'xiaomi', 'huawei', 'мобильный'],
          'Компьютеры и оргтехника': ['ноутбук', 'компьютер', 'монитор', 'клавиатура', 'мышь', 'принтер'],
          'Детский мир': ['детск', 'автокресло', 'коляска', 'игрушка', 'памперс', 'соска', 'детская одежда'],
          'Все для дома': ['мебель', 'стол', 'стул', 'диван', 'кровать', 'шкаф', 'посуда', 'кастрюля'],
          'Животные и растения': ['собака', 'кошка', 'щенок', 'котенок', 'корм', 'растение', 'цветок'],
          'Хобби, музыка и спорт': ['гитара', 'пианино', 'спорт', 'велосипед', 'книга', 'футбол', 'теннис']
        };

        const lowerDesc = description.toLowerCase();

        // Сначала проверяем по ключевым словам
        for (let [category, keywords] of Object.entries(categoryKeywords)) {
          if (keywords.some(keyword => lowerDesc.includes(keyword))) {
            // Проверяем, есть ли эта категория в загруженных категориях
            if (categories[category]) {
              return category;
            }
          }
        }

        // Если не нашли по ключевым словам, возвращаем первую доступную категорию
        const availableCategories = Object.keys(categories);
        return availableCategories.length > 0 ? availableCategories[0] : 'Все для дома';
      };

      const detectSubCategory = (description, mainCategory) => {
        const lowerDesc = description.toLowerCase();

        // Если основная категория определена, ищем подкатегорию в ней
        if (mainCategory && categories[mainCategory]) {
          const subcategories = categories[mainCategory];

          // Ключевые слова для подкатегорий
          const subcategoryKeywords = {
            'Мобильные телефоны': ['телефон', 'смартфон', 'айфон', 'samsung', 'xiaomi'],
            'Аксессуары для телефонов': ['чехол', 'защитное стекло', 'зарядка', 'наушники'],
            'Ноутбуки': ['ноутбук', 'лэптоп'],
            'Персональные компьютеры': ['компьютер', 'системный блок', 'пк'],
            'Мужская одежда': ['мужск', 'рубашка', 'брюки', 'костюм'],
            'Женская одежда': ['женск', 'платье', 'юбка', 'блузка'],
            'Обувь': ['кроссовки', 'ботинки', 'туфли', 'сапоги', 'обувь'],
            'Детская одежда': ['детск', 'детская одежда'],
            'Игрушки': ['игрушка', 'кукла', 'машинка', 'конструктор'],
            'Мебель': ['стол', 'стул', 'диван', 'кровать', 'шкаф']
          };

          // Ищем подходящую подкатегорию
          for (let subcategory of subcategories) {
            if (subcategoryKeywords[subcategory]) {
              const keywords = subcategoryKeywords[subcategory];
              if (keywords.some(keyword => lowerDesc.includes(keyword))) {
                return subcategory;
              }
            }
          }

          // Если не нашли по ключевым словам, возвращаем первую подкатегорию
          return subcategories.length > 0 ? subcategories[0] : '';
        }

        return '';
      };

      const extractPrice = (description) => {
        const priceMatch = description.match(/(\d+)\s*(сомони|доллар|рубл)/i);
        if (priceMatch) {
          return priceMatch[1];
        }
        return '0';
      };

      const extractBrand = (description) => {
        const brands = ['Nike', 'Adidas', 'Samsung', 'Apple', 'HP', 'Dell', 'Sony', 'LG', 'MAXI-COSI', 'IKEA', 'Zara', 'H&M'];
        const lowerDesc = description.toLowerCase();
        for (let brand of brands) {
          if (lowerDesc.includes(brand.toLowerCase())) {
            return brand;
          }
        }
        return '';
      };

      const extractCondition = (description) => {
        const lowerDesc = description.toLowerCase();
        if (lowerDesc.includes('новый') || lowerDesc.includes('новое')) return 'Новое';
        if (lowerDesc.includes('отличное') || lowerDesc.includes('отлично')) return 'Отличное';
        if (lowerDesc.includes('хорошее') || lowerDesc.includes('хорошо')) return 'Хорошее';
        if (lowerDesc.includes('удовлетворительное')) return 'Удовлетворительное';
        return 'Хорошее';
      };

      const updateResult = (id, field, value) => {
        setResults(prev => prev.map(item =>
          item.id === id ? { ...item, [field]: value } : item
        ));
      };

      const deleteResult = (id) => {
        setResults(prev => prev.filter(item => item.id !== id));
      };

      const publishItem = (item) => {
        setPublishedItems(prev => [...prev, { ...item, promotionType: 'standard', days: 0 }]);
      };

      const publishAllItems = () => {
        const itemsToPublish = results.map(item => ({ ...item, promotionType: 'standard', days: 0 }));
        setPublishedItems(itemsToPublish);
        setCurrentStep('promotion');
      };

      const updatePromotion = (id, promotionType, days) => {
        setPublishedItems(prev => prev.map(item =>
          item.id === id ? { ...item, promotionType, days } : item
        ));
      };

      const getPromotionStats = () => {
        const stats = {
          standard: publishedItems.filter(item => item.promotionType === 'standard').length,
          top: publishedItems.filter(item => item.promotionType === 'top').length,
          vip: publishedItems.filter(item => item.promotionType === 'vip').length,
          total: 0
        };

        stats.total = publishedItems.reduce((sum, item) => {
          if (item.promotionType === 'top') return sum + (5 * item.days);
          if (item.promotionType === 'vip') return sum + (10 * item.days);
          return sum;
        }, 0);

        return stats;
      };

      // Логотип Somon.tj
      const SomonLogo = () => (
        <div className="flex items-center">
          <span className="text-somon-blue font-bold text-xl">So</span>
          <span className="text-somon-orange font-bold text-xl">mon</span>
          <span className="text-somon-green font-bold text-xl">.tj</span>
        </div>
      );

      if (currentStep === 'upload') {
        return (
          <div className="min-h-screen bg-gray-50 mobile-container">
            {/* Header */}
            <div className="bg-white border-b border-gray-200 p-4">
              <div className="flex items-center justify-between">
                <SomonLogo />
                <div className="md:hidden">
                  <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" />
                  </svg>
                </div>
              </div>
            </div>

            <div className="p-4 md:p-6 lg:p-8">
              {/* Hero Section */}
              <div className="text-center mb-8">
                <div className="inline-flex items-center justify-center w-16 h-16 md:w-20 md:h-20 bg-somon-orange rounded-full mb-4">
                  <svg className="w-8 h-8 md:w-10 md:h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                </div>
                <h1 className="text-2xl md:text-3xl lg:text-4xl font-bold text-gray-800 mb-2">
                  Подать объявление
                </h1>
                <p className="text-gray-600 text-sm md:text-base max-w-md mx-auto">
                  Загрузите фото товаров для автоматического создания объявлений с помощью ИИ
                </p>
              </div>

              {/* Upload Area */}
              <div className="bg-white rounded-lg border p-4 md:p-6 mb-6">
                <div
                  className={`relative border-2 border-dashed rounded-lg p-6 md:p-8 transition-all ${dragActive ? 'drag-active' : 'border-gray-300'
                    }`}
                  onDragEnter={handleDrag}
                  onDragLeave={handleDrag}
                  onDragOver={handleDrag}
                  onDrop={handleDrop}
                >
                  <input
                    ref={fileInputRef}
                    type="file"
                    multiple
                    accept="image/*"
                    onChange={handleFileSelect}
                    className="hidden"
                  />

                  <div className="text-center">
                    <svg className="w-10 h-10 md:w-12 md:h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <h3 className="text-base md:text-lg font-medium text-gray-700 mb-2">
                      Добавьте фотографии товаров
                    </h3>
                    <p className="text-gray-500 text-sm mb-4">
                      Нажмите для выбора или перетащите сюда
                    </p>
                    <button
                      onClick={() => fileInputRef.current?.click()}
                      className="bg-somon-orange text-white px-6 py-2 md:px-8 md:py-3 rounded-lg text-sm md:text-base font-medium hover:bg-orange-600 transition-colors"
                    >
                      Выбрать фото
                    </button>
                  </div>
                </div>

                {uploadedImages.length > 0 && (
                  <div className="mt-6">
                    <div className="flex items-center justify-between mb-3">
                      <h3 className="text-sm md:text-base font-medium text-gray-700">
                        Загружено: {uploadedImages.length} фото
                      </h3>
                    </div>
                    <div className="grid grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2 md:gap-3">
                      {uploadedImages.map((image) => (
                        <div key={image.id} className="relative">
                          <img
                            src={image.preview}
                            alt={image.name}
                            className="w-full h-20 md:h-24 object-cover rounded border"
                          />
                          <button
                            onClick={() => removeImage(image.id)}
                            className="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 md:w-6 md:h-6 flex items-center justify-center text-xs hover:bg-red-600"
                          >
                            ×
                          </button>
                        </div>
                      ))}
                    </div>
                  </div>
                )}

                {uploadedImages.length > 0 && (
                  <div className="mt-6">
                    <h3 className="text-sm md:text-base font-medium text-gray-700 mb-2">
                      Дополнительная информация о товарах (опционально)
                    </h3>
                    <textarea
                      value={userDescription}
                      onChange={(e) => setUserDescription(e.target.value)}
                      placeholder="Например:
1. Кроссовки Nike, размер 42, новые, цена 500 сомони
2. Стиральная машина LG, 5кг, отличное состояние, 800 сомони  
3. Детское автокресло, красное, хорошее состояние, 300 сомони

Укажите названия, размеры, цены, состояние - это поможет ИИ создать более точные объявления."
                      rows={6}
                      className="w-full p-3 border border-gray-300 rounded-lg text-sm placeholder-gray-400 focus:ring-1 focus:ring-somon-orange focus:border-somon-orange"
                    />
                    <p className="text-xs text-gray-500 mt-1">
                      Необязательно • Поможет ИИ создать более точные описания
                    </p>
                  </div>
                )}

                {uploadedImages.length > 0 && (
                  <div className="mt-6">
                    <button
                      onClick={processImages}
                      disabled={processing}
                      className="w-full bg-somon-orange text-white py-3 md:py-4 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-600 transition-colors"
                    >
                      {processing ? (
                        <div className="flex items-center justify-center">
                          <div className="spinner mr-2"></div>
                          ИИ анализирует товары...
                        </div>
                      ) : (
                        `Анализировать ${uploadedImages.length} товаров с ИИ`
                      )}
                    </button>
                  </div>
                )}
              </div>

              {/* Features */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div className="bg-white rounded-lg border p-4 flex items-center">
                  <div className="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                    <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                  </div>
                  <div>
                    <h3 className="font-medium text-gray-800 text-sm">ИИ распознавание</h3>
                    <p className="text-gray-600 text-xs">Автоматически определяет товары</p>
                  </div>
                </div>

                <div className="bg-white rounded-lg border p-4 flex items-center">
                  <div className="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                    <svg className="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <div>
                    <h3 className="font-medium text-gray-800 text-sm">Умные описания</h3>
                    <p className="text-gray-600 text-xs">Создает описания для продажи</p>
                  </div>
                </div>

                <div className="bg-white rounded-lg border p-4 flex items-center">
                  <div className="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                    <svg className="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <div>
                    <h3 className="font-medium text-gray-800 text-sm">Быстрый анализ</h3>
                    <p className="text-gray-600 text-xs">Мгновенное создание объявлений</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      }

      if (currentStep === 'promotion') {
        const stats = getPromotionStats();

        return (
          <div className="min-h-screen bg-gray-50 mobile-container">
            <div className="bg-white border-b border-gray-200 p-4">
              <div className="flex items-center">
                <button onClick={() => setCurrentStep('results')} className="mr-3">
                  <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                  </svg>
                </button>
                <div className="flex-1">
                  <h1 className="text-lg font-bold text-gray-800">Продвижение</h1>
                </div>
              </div>
            </div>

            <div className="p-4 md:p-6">
              <div className="bg-white rounded-lg border p-4 md:p-6 mb-6">
                <h2 className="text-base md:text-lg font-medium text-gray-800 mb-3">Продвижение объявлений</h2>
                <p className="text-sm text-gray-600 mb-4">
                  Увеличьте просмотры с помощью ТОП и ВИП размещения
                </p>
              </div>

              <div className="space-y-4 mb-6">
                {publishedItems.map((item) => (
                  <PromotionCard key={item.id} item={item} onUpdate={updatePromotion} />
                ))}
              </div>

              <div className="bg-white rounded-lg border p-4 md:p-6 mb-6">
                <h3 className="font-medium text-gray-800 mb-3">Итого</h3>
                <div className="space-y-2">
                  <div className="flex justify-between text-sm">
                    <span className="text-gray-600">Обычных объявлений:</span>
                    <span className="font-medium">{stats.standard}</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-gray-600">ТОП объявлений:</span>
                    <span className="font-medium text-yellow-600">{stats.top}</span>
                  </div>
                  <div className="flex justify-between text-sm">
                    <span className="text-gray-600">ВИП объявлений:</span>
                    <span className="font-medium text-purple-600">{stats.vip}</span>
                  </div>
                  <div className="border-t pt-2">
                    <div className="flex justify-between">
                      <span className="font-medium text-gray-800">Общая стоимость размещения:</span>
                      <span className="font-bold text-somon-orange">{stats.total} сомони</span>
                    </div>
                  </div>
                </div>
              </div>

              <button
                onClick={() => alert('Объявления опубликованы на Somon.tj!')}
                className="w-full bg-somon-orange text-white py-3 md:py-4 rounded-lg font-medium hover:bg-orange-600 transition-colors"
              >
                Опубликовать за {stats.total} сомони
              </button>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gray-50 mobile-container">
          <div className="bg-white border-b border-gray-200 p-4">
            <div className="flex items-center">
              <button onClick={() => setCurrentStep('upload')} className="mr-3">
                <svg className="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
                </svg>
              </button>
              <div className="flex-1">
                <h1 className="text-lg font-bold text-gray-800">Проверьте объявления</h1>
                <p className="text-xs text-gray-600">ИИ нашел {results.length} товаров</p>
              </div>
            </div>
          </div>

          <div className="p-4 md:p-6">
            <div className="space-y-4 mb-6">
              {results.map((item) => (
                <ResultCard
                  key={item.id}
                  item={item}
                  categories={categories}
                  conditions={conditions}
                  currencies={currencies}
                  onUpdate={updateResult}
                  onDelete={deleteResult}
                  onPublish={publishItem}
                />
              ))}
            </div>

            {results.length > 0 && (
              <button
                onClick={publishAllItems}
                className="w-full bg-somon-orange text-white py-3 md:py-4 rounded-lg font-medium hover:bg-orange-600 transition-colors"
              >
                Опубликовать все ({results.length})
              </button>
            )}
          </div>
        </div>
      );
    };

    // Компонент карточки результата
    const ResultCard = ({ item, categories, conditions, currencies, onUpdate, onDelete, onPublish }) => {
      const [formData, setFormData] = useState(item);
      const [isExpanded, setIsExpanded] = useState(false);

      const handleChange = (field, value) => {
        const newData = { ...formData, [field]: value };
        setFormData(newData);
        onUpdate(item.id, field, value);
      };

      const handleMainCategoryChange = (mainCategory) => {
        handleChange('mainCategory', mainCategory);
        if (categories[mainCategory] && categories[mainCategory].length > 0) {
          handleChange('subCategory', categories[mainCategory][0]);
        }
      };

      return (
        <div className="bg-white rounded-lg border product-card">
          <div className="p-4">
            <div className="flex">
              <img
                src={item.images[0]}
                alt={formData.title}
                className="w-16 h-16 md:w-20 md:h-20 object-cover rounded mr-3 flex-shrink-0"
              />
              <div className="flex-1 min-w-0">
                <input
                  type="text"
                  value={formData.title}
                  onChange={(e) => handleChange('title', e.target.value)}
                  className="w-full font-medium text-gray-800 border-none p-0 text-sm md:text-base bg-transparent focus:outline-none"
                  placeholder="Название товара"
                />
                <div className="flex items-center mt-1">
                  <input
                    type="number"
                    value={formData.price}
                    onChange={(e) => handleChange('price', e.target.value)}
                    className="w-16 md:w-20 text-somon-orange font-bold text-sm md:text-base border-none p-0 bg-transparent focus:outline-none"
                    placeholder="0"
                  />
                  <span className="text-somon-orange font-bold text-sm md:text-base ml-1">{formData.currency}</span>
                </div>
                <div className="flex items-center justify-between mt-1">
                  <span className="bg-orange-100 text-orange-800 px-2 py-0.5 rounded text-xs">
                    {formData.mainCategory}
                  </span>
                </div>
              </div>
              <button
                onClick={() => setIsExpanded(!isExpanded)}
                className="text-gray-400 p-1 hover:text-gray-600"
              >
                {isExpanded ? (
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                  </svg>
                ) : (
                  <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                  </svg>
                )}
              </button>
            </div>
          </div>

          {isExpanded && (
            <div className="px-4 pb-4 border-t border-gray-100 pt-4 space-y-3">
              <div>
                <label className="block text-xs text-gray-600 mb-1">Категория</label>
                <select
                  value={formData.mainCategory}
                  onChange={(e) => handleMainCategoryChange(e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
                >
                  {Object.keys(categories).map(cat => (
                    <option key={cat} value={cat}>{cat}</option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-xs text-gray-600 mb-1">Подкатегория</label>
                <select
                  value={formData.subCategory}
                  onChange={(e) => handleChange('subCategory', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
                >
                  {categories[formData.mainCategory]?.map(subcat => (
                    <option key={subcat} value={subcat}>{subcat}</option>
                  ))}
                </select>
              </div>

              <div>
                <label className="block text-xs text-gray-600 mb-1">Описание от ИИ</label>
                <textarea
                  value={formData.description}
                  onChange={(e) => handleChange('description', e.target.value)}
                  rows={8}
                  className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
                  placeholder="Описание товара"
                />
              </div>

              <div className="grid grid-cols-2 gap-3">
                <div>
                  <label className="block text-xs text-gray-600 mb-1">Бренд</label>
                  <input
                    type="text"
                    value={formData.brand}
                    onChange={(e) => handleChange('brand', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
                    placeholder="Бренд"
                  />
                </div>

                <div>
                  <label className="block text-xs text-gray-600 mb-1">Состояние</label>
                  <select
                    value={formData.condition}
                    onChange={(e) => handleChange('condition', e.target.value)}
                    className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
                  >
                    {conditions.map(cond => (
                      <option key={cond} value={cond}>{cond}</option>
                    ))}
                  </select>
                </div>
              </div>

              <div>
                <label className="block text-xs text-gray-600 mb-1">Местоположение</label>
                <input
                  type="text"
                  value={formData.location}
                  onChange={(e) => handleChange('location', e.target.value)}
                  className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
                  placeholder="Город"
                />
              </div>

              <div className="flex space-x-2 pt-2">
                <button
                  onClick={() => onDelete(item.id)}
                  className="flex-1 bg-red-50 text-red-600 py-2 rounded text-sm font-medium hover:bg-red-100 transition-colors"
                >
                  Удалить
                </button>
                <button
                  onClick={() => onPublish(formData)}
                  className="flex-1 bg-somon-orange text-white py-2 rounded text-sm font-medium hover:bg-orange-600 transition-colors"
                >
                  Опубликовать
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    const PromotionCard = ({ item, onUpdate }) => {
      const [promotionType, setPromotionType] = useState('standard');
      const [days, setDays] = useState(3);

      const handlePromotionChange = (type, dayCount) => {
        setPromotionType(type);
        setDays(dayCount);
        onUpdate(item.id, type, dayCount);
      };

      const promotionOptions = [
        { type: 'standard', name: 'Обычное', price: 0, icon: '👁️', desc: 'Стандартное размещение' },
        { type: 'top', name: 'ТОП', price: 5, icon: '⭐', desc: 'Показ в топе категории' },
        { type: 'vip', name: 'ВИП', price: 10, icon: '👑', desc: 'Приоритетный показ' }
      ];

      return (
        <div className="bg-white rounded-lg border p-4">
          <div className="flex mb-4">
            <img src={item.images[0]} alt={item.title} className="w-12 h-12 md:w-16 md:h-16 object-cover rounded mr-3" />
            <div className="flex-1">
              <h3 className="font-medium text-gray-800 text-sm md:text-base">{item.title}</h3>
              <p className="text-xs md:text-sm text-gray-600">{item.price} {item.currency}</p>
            </div>
          </div>

          <div className="space-y-3">
            {promotionOptions.map((option) => (
              <label key={option.type} className="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                <input
                  type="radio"
                  name={`promotion-${item.id}`}
                  value={option.type}
                  checked={promotionType === option.type}
                  onChange={() => handlePromotionChange(option.type, days)}
                  className="mr-3"
                />
                <div className="flex-1">
                  <div className="flex items-center">
                    <span className="text-lg mr-2">{option.icon}</span>
                    <span className="font-medium text-sm">{option.name}</span>
                    {option.price > 0 && (
                      <span className="ml-auto text-somon-orange font-bold text-sm">
                        {option.price} сомони/день
                      </span>
                    )}
                  </div>
                  <p className="text-xs text-gray-500 mt-1">{option.desc}</p>
                </div>
              </label>
            ))}
          </div>

          {(promotionType === 'top' || promotionType === 'vip') && (
            <div className="mt-4">
              <label className="block text-xs text-gray-600 mb-2">Количество дней</label>
              <select
                value={days}
                onChange={(e) => handlePromotionChange(promotionType, parseInt(e.target.value))}
                className="w-full p-2 border border-gray-300 rounded text-sm focus:ring-1 focus:ring-somon-orange"
              >
                {[1, 3, 7, 14, 30].map(day => (
                  <option key={day} value={day}>{day} дней</option>
                ))}
              </select>
            </div>
          )}
        </div>
      );
    };

    // Рендерим приложение
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PhotoListingApp />);
  </script>
</body>

</html>